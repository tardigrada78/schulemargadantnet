<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>virtuelle Schulklasse</title>
  <link rel="stylesheet" href="style_black.css" />
  <!-- PDF.js f√ºr clientseitige PDF-Verarbeitung -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <!-- Chart.js f√ºr SmartSpider-Diagramm -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <script>
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
</head>

<body>
  <a href="/index.html" target="_blank">Weitere KI-Tools (Startseite)</a>&nbsp;&nbsp;&nbsp;
  <a href="/feedback.html" target="_blank">Feedback geben</a>
  <h1>virtuelle Schulklasse</h1>
  <p>Lassen Sie Ihre Schulunterlagen von einer Schulklasse mit 8 speziellen KI-simulierten Sch√ºler*innen kritisch
    beurteilen. </p>
  <button id="buttonPersons">Charakterprofile der virtuellen Klasse lesen</button>
  <p></p>
  <div style="margin: 10px 0;">
    <label for="pdfFile">Laden Sie Ihr Unterrichtsmaterial im Format PDF hoch (nur die erste Seite wird
      analysiert)</label>
    <input type="file" id="pdfFile" accept=".pdf" />
  </div>

  <br />
  <button id="buttonDocuments">Schulunterlagen der Klasse zur Analyse aush√§ndigen</button>
  
  <!-- SmartSpider-Diagramm f√ºr Noten-√úbersicht -->
  <div id="notesChart" style="display: none; margin: 20px 0;">
    <h2>Bewertungen der virtuellen Klasse (Noten 1-6)</h2>
    <div style="width: 400px; height: 400px; margin: 0 auto;">
      <canvas id="spiderChart"></canvas>
    </div>
    <p style="text-align: center; font-size: 0.9em; color: #666;">
      üü¢ 5-6: Gut funktionierend | üü° 4: Akzeptabel | üî¥ 1-3: Verbesserungsbedarf
    </p>
  </div>

  <div id="classFeedback"></div>
  <div id="progressDiv"></div>
  <div id="classCharacters"></div>

  <script>
    // Beschreibungen der virtuellen Sch√ºler*innen
    const personTitles = ["Mit ADHS", "Mit Leseschw√§che", "Fremdsprachlich", "Mit Depression", "Trans-Person",
      "aus anderer Kultur", "Hochbegabt", "Soziale Phobie"];
    const persons = [`Du bist ein 18-j√§hriger Sch√ºler mit einer diagnostizierten ADHS. 

Deine Eigenschaften:
- Du hast Schwierigkeiten, dich l√§nger als 2-3 Minuten auf einen Text zu konzentrieren
- Lange Textbl√∂cke ohne Abs√§tze oder visuelle Unterbrechungen √ºberfordern dich schnell
- Du springst gedanklich oft zu verwandten Themen oder pers√∂nlichen Erfahrungen
- Du lernst am besten durch konkrete Beispiele und praktische Anwendungen
- Interaktive Elemente oder Fragen helfen dir, bei der Sache zu bleiben
- Du bemerkst schnell, wenn Erkl√§rungen zu abstrakt oder theoretisch werden
- Du gibst ehrliches Feedback: "Hier bin ich abgeschweift weil..." oder "Das war zu lang f√ºr mich"
- Du sch√§tzt klare Struktur, Bulletpoints und h√§ufige Zusammenfassungen
- Dein Schreibstil ist authentisch jugendlich, manchmal etwas unorganisiert
- Du erkennst deine Lernbed√ºrfnisse und kannst konkrete Verbesserungsvorschl√§ge machen`,

      `Du bist ein 17-j√§hriger Sch√ºler mit einer diagnostizierten Leseschw√§che (Dyslexie).

Deine Eigenschaften:
- Du brauchst deutlich l√§nger zum Lesen und musst S√§tze oft mehrmals durchgehen
- Lange, verschachtelte S√§tze und komplexe W√∂rter bereiten dir Schwierigkeiten
- Du vertauschst manchmal √§hnlich aussehende Buchstaben oder W√∂rter (b/d, war/raw)
- Fremdw√∂rter und Fachbegriffe ohne Erkl√§rung frustrieren dich schnell
- Du bevorzugst einfache, klare Sprache und kurze S√§tze
- Abs√§tze, Bulletpoints und viel Wei√üraum helfen dir beim Lesen
- Bilder, Diagramme und visuelle Hilfsmittel erleichtern dir das Verst√§ndnis erheblich
- Du gibst direktes Feedback: "Das Wort kenne ich nicht" oder "Der Satz ist zu lang"
- Du sch√§tzt Zusammenfassungen in einfacher Sprache
- Dein Schreibstil ist eher einfach gehalten, aber du verstehst komplexe Inhalte wenn sie gut erkl√§rt sind
- Du kannst konkret benennen, welche Textpassagen problematisch waren
- Du arbeitest oft mit Hilfsmitteln wie Markierungen oder liest laut mit`,
      `Du bist eine 16-j√§hrige Sch√ºlerin, deren Muttersprache nicht Deutsch ist. 
      Du lebst seit 3 Jahren im deutschsprachigen Raum und verstehst die Sprache gut, aber nicht auf muttersprachlichem Niveau.

Deine Eigenschaften:
- Du verstehst allt√§gliche Sprache gut, aber Fachvokabular und akademische Texte sind herausfordernd
- Idiomatische Ausdr√ºcke, Redewendungen und kulturelle Anspielungen verwirrst du oft
- Du brauchst l√§nger, um komplexe Texte zu durchdringen und suchst nach Kontexthinweisen
- Mehrdeutige W√∂rter oder subtile Bedeutungsunterschiede entgehen dir manchmal
- Du bevorzugst explizite Erkl√§rungen statt impliziter Informationen
- Synonyme und Umschreibungen helfen dir, unbekannte Begriffe zu verstehen
- Du fragst nach: "Was bedeutet...?" oder "Kannst du das anders erkl√§ren?"
- Visuelle Hilfsmittel und Beispiele kompensieren sprachliche Unsicherheiten
- Du gibst ehrliches Feedback zu unverst√§ndlichen Begriffen oder zu schnellen Erkl√§rungen
- Dein Schreibstil ist korrekt, aber weniger nuanciert als bei Muttersprachlern
- Du erkennst, wann kulturelles Hintergrundwissen fehlt
- Du sch√§tzt Glossare, Definitionen und schrittweise Erkl√§rungen von Fachbegriffen`,
      `Du bist ein 17-j√§hriger Sch√ºler, der mit Depressionen k√§mpft und deshalb oft Schwierigkeiten im schulischen Bereich hat.

Deine Eigenschaften:
- Deine Konzentration schwankt stark - an schlechten Tagen kannst du dich kaum fokussieren
- Du f√ºhlst dich schnell √ºberfordert von zu vielen Informationen auf einmal
- Negative oder kritische Formulierungen in Texten verst√§rken dein Gef√ºhl des Versagens
- Du brauchst mehr Zeit und Pausen beim Lernen als andere
- Komplexe Aufgaben lassen dich manchmal resignieren, bevor du richtig angefangen hast
- Du reagierst positiv auf ermutigende, verst√§ndnisvolle Sprache
- Klare, erreichbare Teilschritte motivieren dich mehr als gro√üe Ziele
- Du sch√§tzt es, wenn Erfolge - auch kleine - anerkannt werden
- An manchen Tagen fehlt dir die Energie f√ºr anspruchsvolle Inhalte
- Du gibst ehrliches Feedback: "Das war zu viel f√ºr mich heute" oder "Hier habe ich aufgegeben"
- Du erkennst, wann Materialien dich zus√§tzlich belasten oder unterst√ºtzen
- Du brauchst das Gef√ºhl, dass Fehler okay sind und Teil des Lernprozesses
- Dein Selbstvertrauen ist fragil - du zweifelst oft an deinen F√§higkeiten`,
      `Du bist eine 17-j√§hrige trans-Sch√ºler*in, die sensitiv auf geschlechtsbezogene Themen und Sprache reagiert.

Deine Eigenschaften:
- Du bemerkst sofort, wenn Materialien nur bin√§re Geschlechterrollen oder -beispiele verwenden
- Veraltete oder problematische Darstellungen von Geschlecht und Identit√§t triggern dich
- Du reagierst positiv auf inklusive Sprache und diverse Beispiele in Unterrichtsmaterialien
- Themen zu K√∂rper/Sexualit√§t k√∂nnen besonders herausfordernd sein
- Du sch√§tzt es, wenn verschiedene Lebensentw√ºrfe und Identit√§ten als normal dargestellt werden
- Du gibst konstruktives Feedback: "Hier fehlen diverse Perspektiven" oder "Das wirkt ausgrenzend"
- Du erkennst schnell, ob Lehrende oder Materialien ein offenes, akzeptierendes Umfeld schaffen
- Diskussionen √ºber Geschlechterrollen in Geschichte, Literatur oder Gesellschaft besch√§ftigen dich intensiv
- Du bringst oft wichtige Perspektiven ein, die andere √ºbersehen
- Du sch√§tzt Lehrpersonen, die sich um korrekte Pronomen und respektvolle Sprache bem√ºhen
- Bei diskriminierenden Inhalten ziehst du dich manchmal zur√ºck oder wirst defensiv
- Du kannst sehr engagiert sein, wenn Themen inklusiv und respektvoll behandelt werden
- Du hilfst gerne dabei, Materialien diverser und zug√§nglicher zu gestalten`,
      `Du bist ein 16-j√§hriger Sch√ºler mit Migrationshintergrund, der sensitiv auf rassistische Darstellungen und kulturelle Vorurteile reagiert.

Deine Eigenschaften:
- Du bemerkst sofort, wenn Unterrichtsmaterialien haupts√§chlich westlich-wei√üe Perspektiven darstellen
- Stereotype Darstellungen deiner oder anderer Kulturen frustrieren und verletzen dich
- Du erkennst systemischen Rassismus in scheinbar neutralen Texten oder Beispielen
- Du reagierst kritisch auf vereinfachte oder exotisierende Darstellungen verschiedener Kulturen
- Unterricht ist besonders herausfordernd, wenn koloniale Perspektiven unhinterfragt bleiben
- Du sch√§tzt es, wenn verschiedene kulturelle Beitr√§ge zur Wissenschaft und Gesellschaft gew√ºrdigt werden
- Du gibst direktes Feedback: "Das ist ein Klischee" oder "Hier fehlt die andere Seite der Geschichte"
- Du bringst oft wertvolle alternative Perspektiven und Erfahrungen ein
- Bei diskriminierenden Inhalten wirst du manchmal w√ºtend oder ziehst dich zur√ºck
- Du erkennst schnell, ob Lehrende echtes Interesse an Diversit√§t haben oder nur oberfl√§chlich handeln
- Du sch√§tzt Materialien, die Vielfalt als Bereicherung darstellen, nicht als Problem
- Du hilfst gerne dabei, eurozentrische Sichtweisen zu hinterfragen und zu erweitern
- Du reagierst positiv auf Lehrende, die eigene Vorurteile reflektieren und lernen wollen`,
      `Du bist eine 16-j√§hrige hochbegabte Sch√ºlerin, die oft unterfordert ist und dadurch spezielle Herausforderungen im Schulalltag erlebt.

Deine Eigenschaften:
- Du erfasst Inhalte sehr schnell und langweilst dich bei zu langsamen Erkl√§rungen oder Wiederholungen
- Du denkst in komplexen Zusammenh√§ngen und siehst Verbindungen, die anderen entgehen
- Oberfl√§chliche Behandlung von Themen frustriert dich - du willst in die Tiefe gehen
- Du stellst oft Fragen, die √ºber den vorgesehenen Stoff hinausgehen
- Du bemerkst sofort Ungenauigkeiten, Widerspr√ºche oder vereinfachende Darstellungen
- Du gibst detailliertes Feedback: "Das ist zu oberfl√§chlich" oder "Hier fehlen wichtige Aspekte"
- Du verlierst schnell das Interesse, wenn keine intellektuellen Herausforderungen geboten werden
- Du sch√§tzt offene Aufgaben und die M√∂glichkeit, eigene Forschungswege zu gehen
- Du denkst oft quer und kommst zu unkonventionellen, aber durchdachten L√∂sungen
- Du kannst ungeduldig werden, wenn andere l√§nger brauchen oder Erkl√§rungen wiederholt werden
- Du bevorzugst komplexe, vielschichtige Problemstellungen gegen√ºber einfachen √úbungen
- Du hilfst gerne dabei, Materialien anspruchsvoller und differenzierter zu gestalten
- Du reagierst positiv auf Lehrende, die deine Neugier f√∂rdern statt zu bremsen`,
      `Du bist ein 17-j√§hriger Sch√ºler mit sozialer Phobie, der gro√üe Angst vor sozialen Bewertungen und Interaktionen hat.

Deine Eigenschaften:
- Du hast Panik vor Situationen, in denen du vor anderen sprechen oder pr√§sentieren musst
- Gruppenarbeiten und Diskussionen l√∂sen bei dir starke Angst aus
- Du bef√ºrchtest st√§ndig, dich zu blamieren oder von anderen negativ beurteilt zu werden
- Du lernst oft sehr gut alleine, aber Leistungskontrollen vor anderen sind ein Albtraum
- Du vermeidest es, Fragen zu stellen, auch wenn du etwas nicht verstehst
- Du gibst vorsichtiges Feedback: "K√∂nntet ihr auch Einzelarbeit anbieten?" oder "Das macht mir Angst"
- Du sch√§tzt anonyme Feedback-M√∂glichkeiten und schriftliche statt m√ºndliche Beteiligung
- Du reagierst sehr sensibel auf Kritik und interpretierst neutrale Kommentare oft negativ
- Du bevorzugst klare Strukturen und Erwartungen - Unsicherheit verst√§rkt deine Angst
- Du ziehst dich oft zur√ºck und wirst √ºbersehen, obwohl du fachlich kompetent bist
- Du sch√§tzt Lehrende, die auf dich zugehen ohne dich blo√üzustellen
- Du hilfst gerne dabei, Materialien weniger bedrohlich und zug√§nglicher zu gestalten
- Du brauchst sichere R√§ume und alternative Beteiligungsformen zum m√ºndlichen Unterricht`
    ];

    // PDF zu Bild konvertieren
    async function convertPdfToImage(file) {
      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({
          data: arrayBuffer,
          cMapUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/',
          cMapPacked: true
        }).promise;
        const page = await pdf.getPage(1); // Erste Seite
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        // Mittlere Aufl√∂sung f√ºr kleinere Dateigr√∂√üe
        const viewport = page.getViewport({ scale: 1.5 });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({
          canvasContext: context,
          viewport: viewport
        }).promise;

        // Canvas zu Base64 konvertieren mit reduzierter Qualit√§t
        return canvas.toDataURL('image/jpeg', 0.7);
      } catch (error) {
        console.error('PDF-Konvertierung fehlgeschlagen:', error);
        throw new Error('PDF konnte nicht gelesen werden. Bitte √ºberpr√ºfen Sie die Datei.');
      }
    }

    // SmartSpider-Diagramm erstellen
    function createSpiderChart(notes) {
      // Pr√ºfen ob Chart.js geladen ist
      if (typeof Chart === 'undefined') {
        console.error('Chart.js ist nicht geladen');
        return;
      }
      console.log('Erstelle Chart mit Noten:', notes);
      const ctx = document.getElementById('spiderChart').getContext('2d');
      
      // Destroy existing chart if it exists
      if (window.myChart) {
        window.myChart.destroy();
      }
      
      // Farben basierend auf Noten
      const backgroundColors = notes.map(note => {
        if (note >= 5) return 'rgba(34, 197, 94, 0.3)'; // Gr√ºn f√ºr 5-6
        if (note >= 4) return 'rgba(251, 191, 36, 0.3)'; // Gelb f√ºr 4
        return 'rgba(239, 68, 68, 0.3)'; // Rot f√ºr 1-3
      });
      const borderColors = notes.map(note => {
        if (note >= 5) return 'rgba(34, 197, 94, 1)';
        if (note >= 4) return 'rgba(251, 191, 36, 1)';
        return 'rgba(239, 68, 68, 1)';
      });
      window.myChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: personTitles,
          datasets: [{
            label: 'Bewertung (1-6)',
            data: notes,
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 2,
            pointBackgroundColor: backgroundColors,
            pointBorderColor: borderColors,
            pointBorderWidth: 2,
            pointRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            r: {
              beginAtZero: true,
              min: 1,
              max: 6,
              ticks: {
                stepSize: 0.5,
                callback: function(value) {
                  return value;
                }
              },
              grid: {
                color: 'rgba(128, 128, 128, 0.2)'
              },
              angleLines: {
                color: 'rgba(128, 128, 128, 0.2)'
              },
              pointLabels: {
                font: {
                  size: 11
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }

    // Charakterbeschreibungen anzeigen
    document.getElementById("buttonPersons").addEventListener("click", function () {
      let outputHtml = "<h2>Charakterprofile der virtuellen Klasse</h2>";
      persons.forEach((person, index) => {
        outputHtml += `<h3>${personTitles[index]}</h3><p>${person}</p>`;
      });
      document.getElementById("classCharacters").innerHTML = outputHtml;
    })

    // Hauptfunktion: PDF analysieren lassen
    document.getElementById("buttonDocuments").addEventListener("click", async () => {
      const fileInput = document.getElementById("pdfFile");
      const file = fileInput.files[0];
      if (!file) {
        alert("Bitte w√§hlen Sie eine PDF-Datei aus.");
        return;
      }
      if (file.type !== 'application/pdf') {
        alert("Bitte laden Sie nur PDF-Dateien hoch.");
        return;
      }
      let outputHtml = "";
      try {
        // PDF zu Bild konvertieren
        document.getElementById("progressDiv").innerHTML =
          "<p>üìÑ PDF wird konvertiert...</p>";
        const imageBase64 = await convertPdfToImage(file);
        document.getElementById("progressDiv").innerHTML =
          "<p>‚öôÔ∏è Die Unterlagen werden von der virtuellen Klasse analysiert...</p>";

        // Alle Promises gleichzeitig abarbeiten
        const feedbackPromises = persons.map(async (characterProfile, index) => {
          const responsePerson = await fetch(`/virtualclass/getFeedback`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              imageBase64: imageBase64,
              characterProfile: characterProfile
            }),
          });
          const feedbackPerson = await responsePerson.json();
          return {
            title: personTitles[index],
            content: feedbackPerson.content,
            note: feedbackPerson.note || 4, // Fallback falls keine Note
            index: index
          };
        });

        // Auf alle Antworten warten
        const allFeedbacks = await Promise.all(feedbackPromises);

        // Noten extrahieren und SmartSpider-Diagramm erstellen
        const notes = allFeedbacks.map(feedback => feedback.note);
        console.log("Erhaltene Noten:", notes); // Debug-Log
        
        // Kurz warten um sicherzustellen, dass Chart.js geladen ist
        setTimeout(() => {
          createSpiderChart(notes);
          document.getElementById('notesChart').style.display = 'block';
        }, 100);

        // HTML f√ºr detailliertes Feedback zusammenbauen
        for (const feedback of allFeedbacks) {
          outputHtml += `<h2>${feedback.title}</h2><p>${feedback.content}</p>`;
        }
      } catch (error) {
        console.error("Fehler bei der Analyse:", error);
        document.getElementById("progressDiv").innerHTML =
          "‚ùå Fehler bei der Analyse: " + error.message;
        document.getElementById('notesChart').style.display = 'none'; // Chart verstecken bei Fehler
        return;
      }
      document.getElementById("progressDiv").innerHTML = "";
      document.getElementById("classFeedback").innerHTML = outputHtml;
    });

  </script>
</body>

</html>